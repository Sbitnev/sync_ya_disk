# Changelog - Изменения в конфигурации обработки файлов

## Дата: 2026-01-19

### Основные изменения

#### 1. Видео файлы - полный пропуск
- **SKIP_VIDEO_FILES = True** - видео файлы больше НЕ загружаются и НЕ обрабатываются
- **CONVERT_VIDEO_FILES = False** - транскрибация видео отключена
- Видео файлы (.mp4, .webm, .avi и др.) полностью исключены из синхронизации
- Экономия ~126 ГБ (60% от общего объема папки /Клиенты)

#### 2. Табличные файлы - конвертация в CSV
- **EXCEL_TO_CSV = True** - Excel файлы (.xlsx, .xls, .xlsm, .xlsb) конвертируются в CSV
- **PARQUET_TO_CSV = True** - Parquet файлы конвертируются в CSV
- Имена файлов сохраняют оригинальное расширение:
  - `report.xlsx` → `report.xlsx.csv` (если 1 лист)
  - `data.parquet` → `data.parquet.csv`
- Для Excel с несколькими листами создаются отдельные CSV файлы с нумерацией и названием листа:
  - `продажи.xlsx` (листы: "Январь", "Февраль", "Март")
    - → `продажи.xlsx_лист1_Январь.csv`
    - → `продажи.xlsx_лист2_Февраль.csv`
    - → `продажи.xlsx_лист3_Март.csv`
  - Запрещенные символы в названиях листов заменяются на подчеркивание
  - Название листа ограничено 50 символами

#### 3. Изображения - полный пропуск
- **SKIP_IMAGE_FILES = True** - файлы изображений НЕ загружаются
- Расширения изображений: .png, .jpg, .jpeg, .gif, .bmp, .tif, .tiff, .svg, .webp, .ico
- Экономия ~33 ГБ

#### 4. Изображения в документах - замена на заглушки
- **REPLACE_IMAGES_WITH_PLACEHOLDERS = True** - изображения в Word документах заменяются на текстовые заглушки
- В Word документах изображения заменяются на `[Изображение удалено]`
- PDF файлы: изображения автоматически не включаются (только текст)
- Страницы PDF с изображениями без текста отображаются как `_Страница не содержит текста или содержит только изображения_`

### Измененные файлы

#### Конфигурация
- `src/config.py` - добавлены новые настройки

#### Синхронизатор
- `src/syncer.py`:
  - Добавлена функция `is_image_file()` для проверки файлов изображений
  - Обновлена логика пропуска файлов
  - Добавлен счетчик пропущенных изображений в статистику
  - Обновлена логика определения расширения выходного файла для табличных форматов

#### Конвертеры
- `src/converters/excel_converter.py`:
  - Добавлен метод `_convert_to_csv()` для конвертации в CSV
  - Поддержка многолистовых Excel файлов (каждый лист в отдельный CSV)
  - Автоматический выбор формата на основе настройки EXCEL_TO_CSV

- `src/converters/parquet_converter.py`:
  - Добавлен метод `_convert_to_csv()` для конвертации в CSV
  - Автоматический выбор формата на основе настройки PARQUET_TO_CSV

- `src/converters/word_converter.py`:
  - Обновлен метод `_convert_with_mammoth()` для замены изображений на заглушки
  - Обновлен метод `_convert_with_pandoc()` для пропуска извлечения медиа при включенной настройке
  - Учитывается настройка REPLACE_IMAGES_WITH_PLACEHOLDERS

### Ожидаемые результаты

#### Экономия места
- Видео файлы: ~126 ГБ (не загружаются)
- Изображения: ~33 ГБ (не загружаются)
- **Общая экономия:** ~159 ГБ из 207 ГБ

#### Ожидаемый объем после изменений
- CSV файлы: ~40.5 ГБ (без изменений, уже были)
- Табличные файлы в CSV:
  - Excel → CSV: ~7.4 ГБ (вместо Markdown ~5.9 ГБ + 1.5 ГБ)
  - Parquet → CSV: ~19.7 ГБ (вместо Markdown)
- Word/PDF в Markdown: ~1.2 ГБ (без изображений)
- Прочие файлы: ~1 ГБ

**Итого:** ~48-50 ГБ (вместо 207 ГБ) - экономия 77%

### Примеры конвертации

#### До изменений:
```
report.xlsx → report.xlsx.md (Markdown с таблицами)
data.parquet → data.parquet.md (Markdown с таблицами)
document.docx → document.docx.md (Markdown с изображениями)
video.mp4 → video.mp4.md (Транскрипция видео)
photo.jpg → (загружен как есть)
```

#### После изменений:
```
report.xlsx (1 лист "Данные") → report.xlsx.csv

продажи.xlsx (3 листа) → продажи.xlsx_лист1_Январь.csv
                       → продажи.xlsx_лист2_Февраль.csv
                       → продажи.xlsx_лист3_Март.csv

отчет.xlsx (лист "Q1/2024") → отчет.xlsx_лист1_Q1_2024.csv  (символ / заменен)

data.parquet → data.parquet.csv
document.docx → document.docx.md (без изображений, заглушки)
video.mp4 → (НЕ загружается)
photo.jpg → (НЕ загружается)
```

### Тестирование

Для тестирования изменений запустите:
```bash
python run.py
```

Проверьте:
1. Видео файлы не загружаются (в статистике: "Видео (пропущено): X")
2. Изображения не загружаются (в статистике: "Изображения (пропущено): X")
3. Excel файлы сохраняются как CSV
4. Parquet файлы сохраняются как CSV
5. Word документы содержат заглушки вместо изображений
