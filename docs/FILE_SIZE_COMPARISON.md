# Сравнение размеров исходных и преобразованных файлов

**Дата анализа**: 20 января 2026
**Исходные файлы**: Яндекс.Диск (из БД sync_metadata.db)
**Преобразованные файлы**: localdata/markdown_files

---

## Общая статистика

### Все файлы (включая part-файлы):
- **Сопоставлено файлов**: 4,082
- **Размер исходных**: 17.2 ГБ
- **Размер преобразованных**: 71.5 ГБ
- **Общее увеличение**: **54.3 ГБ** (4.15x)
- **Средний коэффициент**: 1.23x

### Без part-файлов (обычные документы):
- **Сопоставлено файлов**: 3,953
- **Размер исходных**: 7.9 ГБ
- **Размер преобразованных**: 8.5 ГБ
- **Общее увеличение**: **617.7 МБ** (1.08x)
- **Средний коэффициент**: 1.03x

---

## ТОП-20 файлов с наибольшим увеличением (все типы)

| № | Коэфф. | Исходный | Преобразован | Файл |
|---|--------|----------|--------------|------|
| 1 | **18.3x** | 55.7 МБ | **1.0 ГБ** | part-00002...snappy.parquet |
| 2 | **18.3x** | 55.7 МБ | **1.0 ГБ** | part-00008...snappy.parquet |
| 3-9 | **18.2-18.3x** | ~56 МБ | **~1.0 ГБ** | part-файлы (транзакции) |
| 10-20 | **17.3x** | ~60 МБ | **1.0 ГБ** | part-файлы (остатки) |

### Ключевые наблюдения:

1. **Parquet файлы** - самое большое увеличение:
   - Исходный размер: ~56-60 МБ (сжатый Parquet)
   - После конвертации в CSV: ~1.0 ГБ
   - Коэффициент: **17-18x**
   - Причина: Parquet - высокосжатый колоночный формат

2. **Два типа Parquet файлов**:
   - `be3eeb7b-674a-4738` - транзакции (100 файлов, ~35 ГБ распакованных)
   - `9affeaf0-e8ea-4003` - остатки (30+ файлов, ~20 ГБ распакованных)

3. **Всего part-файлов**: 129 (0 исходных + 129 преобразованных)
   - Суммарный исходный размер: ~9 ГБ
   - Суммарный преобразованный размер: ~63 ГБ
   - Увеличение: **~54 ГБ**

---

## ТОП-20 файлов с наибольшим увеличением (БЕЗ part-файлов)

| № | Коэфф. | Исходный | Преобразован | Файл | Тип |
|---|--------|----------|--------------|------|-----|
| 1 | **11.2x** | 25.0 КБ | **280.0 КБ** | Договор.txt | TXT |
| 2 | **6.9x** | 12.5 МБ | **86.2 МБ** | Лид процесс.xlsx | Excel |
| 3 | **6.7x** | 11.5 МБ | **77.0 МБ** | Планирование проектов.xlsx | Excel |
| 4 | **6.6x** | 471.1 КБ | **3.0 МБ** | Реестр обратно по качеству_18.04.2025.xlsx | Excel |
| 5 | **6.5x** | 427.3 КБ | **2.7 МБ** | Реестр обратно по качеству.xlsx | Excel |
| 6 | **6.2x** | 813.4 КБ | **4.9 МБ** | Отчет_по_настройке_РП_одна_страница... | Excel |
| 7 | **5.9x** | 852.5 КБ | **4.9 МБ** | Реестр обратно по магазин.xlsx | Excel |
| 8 | **5.8x** | 287.8 КБ | **1.6 МБ** | 4 неб о ГО_Мегафон.xlsx | Excel |
| 9 | **5.8x** | 1.7 МБ | **10.1 МБ** | Отделка склады аптечка (4).xlsx | Excel |
| 10 | **5.5x** | 41.0 КБ | **227.4 КБ** | Расшифровка-1.xlsx | Excel |
| 11 | **5.4x** | 547.1 КБ | **2.9 МБ** | Реестр обратно по мерчендайз.xlsx | Excel |
| 12 | **5.4x** | 176.1 КБ | **947.4 КБ** | Мониторинг КАД индекс 04.09.25.xlsx | Excel |
| 13 | **5.3x** | 521.9 КБ | **2.7 МБ** | Реестр обратно по остатки.xlsx | Excel |
| 14 | **5.3x** | 302.5 КБ | **1.6 МБ** | Ассортимент базовый _ 36,6... | Excel |
| 15 | **5.3x** | 266.7 КБ | **1.4 МБ** | Неде 08 01.xlsx | Excel |
| 16 | **5.2x** | 316.0 КБ | **1.6 МБ** | Мониторинг КА 04.12.xlsx | Excel |
| 17 | **5.1x** | 915.5 КБ | **4.6 МБ** | data_online_лаб.csv | CSV |
| 18 | **5.0x** | 223.1 КБ | **1.1 МБ** | Мониторинг сзв ка 25.09.xlsx | Excel |
| 19 | **5.0x** | 214.8 КБ | **1.1 МБ** | Мониторинг сзв ка 09.10.xlsx | Excel |
| 20 | **5.0x** | 282.9 КБ | **1.4 МБ** | Неде 19 01.xlsx | Excel |

### Анализ по типам файлов:

#### Excel файлы (.xlsx):
- **Средний коэффициент**: 5.0-6.9x
- **Причина увеличения**:
  - Excel хранит данные в сжатом XML формате
  - После конвертации в Markdown создаются полные таблицы в текстовом формате
  - Форматирование, формулы, графики конвертируются в текст
- **Примеры**:
  - Небольшой файл 12.5 МБ → 86.2 МБ (почти 7x)
  - Файл с таблицами 471 КБ → 3.0 МБ (6.6x)

#### TXT файлы:
- **Рекордсмен**: Договор.txt (11.2x)
  - 25 КБ → 280 КБ
- **Причина**: Возможно добавление метаданных, форматирования в Markdown

#### CSV файлы:
- **Коэффициент**: ~5x
- Пример: data_online_лаб.csv (915 КБ → 4.6 МБ)

---

## Распределение файлов по коэффициенту увеличения

### Все файлы (4,082):

| Диапазон | Количество | Процент | График |
|----------|------------|---------|--------|
| **< 1x (сжатие)** | 2,371 | **58.1%** | ############################# |
| **1-2x** | 810 | 19.8% | ######### |
| **2-5x** | 853 | 20.9% | ########## |
| **5-10x** | 19 | 0.5% | |
| **10-50x** | 29 | 0.7% | |
| **> 50x** | 0 | 0.0% | |

### Ключевые выводы:

1. **58% файлов УМЕНЬШИЛИСЬ** после преобразования:
   - Изображения конвертируются в ссылки/миниатюры
   - PDF конвертируются в текст (без картинок)
   - Видео не конвертируются, только метаданные

2. **20% файлов незначительно увеличились** (1-2x):
   - Простые документы Word, небольшие таблицы
   - Добавление Markdown разметки

3. **21% файлов заметно увеличились** (2-5x):
   - Сложные Excel таблицы
   - Документы с форматированием

4. **1.2% файлов сильно увеличились** (5x+):
   - Excel с большими таблицами и формулами
   - Parquet файлы (BigData)

---

## Детальный анализ увеличения

### По типам файлов:

| Тип файла | Типичный коэффициент | Причина | Рекомендация |
|-----------|---------------------|---------|--------------|
| **.parquet** | **17-18x** | Колоночный сжатый формат → CSV | Хранить в исходном формате |
| **.xlsx** | **5-7x** | Сжатый XML → текстовые таблицы | OK для работы |
| **.csv** | **5x** | Добавление метаданных, .md обертка | OK |
| **.txt** | **11x** | Добавление разметки Markdown | Проверить необходимость |
| **.docx** | **1-2x** | Незначительное увеличение | OK |
| **.pdf** | **< 1x** | Извлечение текста без картинок | OK |
| **.jpg/.png** | **< 1x** | Ссылка + миниатюра | OK |
| **.mp4/.avi** | **< 1x** | Только метаданные | OK |

---

## Рекомендации по оптимизации

### 1. Parquet файлы (критично)

**Проблема**: 129 файлов занимают ~63 ГБ после конвертации (было ~9 ГБ)

**Решение**:
```bash
# Не конвертировать Parquet в CSV, оставить в исходном формате
# Настроить исключение в конфигурации синхронизации:
SKIP_CONVERSION_FOR = ['.parquet']
```

**Экономия**: **54 ГБ**

### 2. Excel файлы с большими таблицами

**Проблема**: Файлы с таблицами увеличиваются в 5-7 раз

**Варианты**:
1. Конвертировать только первые N строк таблиц
2. Создавать ссылки на таблицы вместо полной конвертации
3. Хранить исходные Excel файлы в архиве

**Экономия**: ~2-3 ГБ

### 3. Архивы

**Проблема**: Распакованные архивы занимают 10.1 ГБ

**Решение**:
```powershell
# Удалить все *_extracted папки
Remove-Item -Path "localdata\markdown_files\*_extracted" -Recurse -Force
```

**Экономия**: **10.1 ГБ**

---

## Итоговая экономия

| Действие | Экономия | Сложность |
|----------|----------|-----------|
| Не конвертировать Parquet файлы | **54 ГБ** | Низкая (изменить конфиг) |
| Удалить распакованные архивы | **10 ГБ** | Низкая (одна команда) |
| Оптимизировать Excel конвертацию | **2-3 ГБ** | Средняя (изменить код) |
| **ИТОГО** | **64-67 ГБ** | - |

### Текущее использование:
- **Сейчас**: 90.3 ГБ
- **После оптимизации**: ~25 ГБ
- **Экономия**: **72%**

---

## Выводы

1. **Parquet файлы - главная проблема**:
   - Занимают 70% дискового пространства после конвертации
   - Увеличиваются в 17-18 раз
   - Рекомендация: не конвертировать, хранить в исходном формате

2. **Excel файлы увеличиваются разумно**:
   - Коэффициент 5-7x приемлем для работы с данными
   - Markdown таблицы удобны для просмотра и поиска

3. **Большинство файлов (58%) уменьшаются**:
   - Система эффективно работает с изображениями и видео
   - PDF конвертация в текст экономит место

4. **Распакованные архивы - лишние данные**:
   - 10 ГБ можно освободить без потери функциональности
   - Исходные архивы доступны на Яндекс.Диске

---

**Отчет создан**: 20 января 2026
**Скрипты**: `compare_sizes.py`, `compare_sizes_no_parts.py`
**Версия**: 1.0
