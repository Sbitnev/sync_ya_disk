# Отчет о доступе к папке "Клиенты" (Яндекс.Диск)

## Цель
Получить доступ к папке "Клиенты" по публичной ссылке https://disk.yandex.ru/d/_JeaJNmm6UeQVA и скачать из нее файлы.

## Что выяснили

### 1. Информация о публичной папке
- **URL**: https://disk.yandex.ru/d/_JeaJNmm6UeQVA
- **Название в API**: "Проекты" (в веб-интерфейсе: "Клиенты")
- **Владелец**: tn@imprice.ai (Nikita Tsukanov)
- **User ID владельца**: 1130000057842996
- **Тип**: Публичная папка на личном диске пользователя
- **Содержимое**: 50+ подпапок с проектами (DPD, KDL, SOKOLOV, и т.д.)

### 2. Ограничения владельца
Владелец папки установил следующие ограничения:
- ❌ **Запрещено прямое скачивание файлов** - API возвращает пустую ссылку на скачивание
- ❌ **Запрещено сохранение на другие диски** - попытка сохранить папку на диск организации возвращает 403 Forbidden
- ✅ **Разрешено чтение метаданных** - можно просматривать список папок и файлов

### 3. Доступные токены
У нас есть:
- **Административный токен** (YANDEX_ADMIN_TOKEN)
  - Организация ID: 7140966
  - Имеет доступ к диску организации (5 папок: 265, SU, backup, Домашняя, Общая папка)
  - НЕ имеет доступа к личным дискам пользователей организации
  - Заголовок X-Uid не переключает контекст на личный диск

### 4. Что НЕ работает
❌ Прямое скачивание через публичный API
❌ Сохранение на диск организации
❌ Получение токена пользователя через Admin API (endpoint не существует)
❌ Подключение сервисного приложения к пользователю (endpoint не существует)
❌ Доступ к личному диску через административный токен
❌ Токен имперсонации пользователя

### 5. Архитектура Яндекс.Диска для организаций
```
Яндекс 360 Организация (ID: 7140966)
│
├── Диск организации (общий)
│   ├── 265
│   ├── SU
│   ├── backup
│   ├── Домашняя
│   └── Общая папка
│
└── Личные диски пользователей (недоступны через Admin API)
    └── tn@imprice.ai (ID: 1130000057842996)
        └── Клиенты (Проекты) ← ЗДЕСЬ НАХОДИТСЯ НУЖНАЯ ПАПКА
            ├── DPD
            ├── KDL
            ├── SOKOLOV
            └── ... (50+ папок)
```

## Возможные решения

### Решение 1: Расшаривание на организацию (Рекомендуется)
**Что нужно сделать:**
1. Пользователь tn@imprice.ai заходит в веб-интерфейс Яндекс.Диска
2. Открывает папку "Клиенты"
3. Нажимает "Поделиться" → "Доступ для сотрудников"
4. Добавляет организацию или конкретных пользователей
5. Устанавливает права "Чтение" или "Редактирование"

**Результат:** Папка появится на диске организации и будет доступна через административный токен.

### Решение 2: Персональный токен пользователя
**Что нужно сделать:**
1. Пользователь tn@imprice.ai создает OAuth-приложение на https://oauth.yandex.ru/
2. Получает CLIENT_ID и CLIENT_SECRET
3. Авторизуется и получает токен с правами `cloud_api:disk.read`
4. Передает этот токен для использования

**Результат:** Токен будет иметь полный доступ к личному диску пользователя.

### Решение 3: Снятие ограничений на публичную папку
**Что нужно сделать:**
1. Пользователь tn@imprice.ai открывает настройки публичной ссылки
2. Разрешает скачивание файлов
3. Разрешает сохранение на другие диски

**Результат:** Можно будет скачивать файлы через публичный API.

### Решение 4: Ручное скачивание
**Что нужно сделать:**
1. Открыть публичную ссылку в браузере
2. Скачать нужные файлы вручную

**Результат:** Файлы будут скачаны, но процесс не автоматизирован.

## Рекомендация
Лучший вариант - **Решение 1 (Расшаривание на организацию)**, потому что:
- Не требует создания дополнительных токенов
- Дает постоянный доступ через существующий административный токен
- Позволяет другим сотрудникам организации работать с папкой
- Сохраняет контроль владельца над правами доступа

## Технические детали
- API endpoint для диска: `https://cloud-api.yandex.net/v1/disk/resources`
- API endpoint для публичных ресурсов: `https://cloud-api.yandex.net/v1/disk/public/resources`
- API endpoint для Яндекс 360: `https://api360.yandex.net/`
- Документация: https://yandex.ru/dev/disk-api/doc/ru/

## Созданные скрипты
1. `list_folders.py` - вывод папок на диске организации
2. `check_public_access.py` - проверка доступа к публичной папке
3. `download_public_file.py` - попытка скачивания файла (не работает)
4. `get_user_token.py` - попытка получить токен пользователя через Admin API
5. `find_tn_user.py` - поиск пользователя в организации
6. `access_tn_disk.py` - попытка доступа к личному диску пользователя
