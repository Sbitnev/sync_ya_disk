# Логирование

Проект использует библиотеку [loguru](https://github.com/Delgan/loguru) для продвинутого логирования.

## Конфигурация

Логирование настроено в `src/main.py`:

```python
# Консольный вывод (INFO и выше)
logger.add(
    sys.stderr,
    format="<green>{time:HH:mm:ss}</green> | <level>{level: <8}</level> | <level>{message}</level>",
    level="INFO",
    colorize=True
)

# Файловый вывод (DEBUG и выше)
logger.add(
    "logs/sync_ya_disk.log",
    format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {message}",
    level="DEBUG",
    rotation="10 MB",
    retention="7 days",
    compression="zip"
)
```

## Уровни логирования

- **DEBUG** - детальная отладочная информация (только в файле)
  - Детали HTTP запросов
  - Параметры API вызовов
  - Информация о retry попытках

- **INFO** - общая информация о процессе (консоль + файл)
  - Начало/завершение операций
  - Статистика по файлам
  - Прогресс выполнения

- **SUCCESS** - успешные операции (консоль + файл)
  - Скачанные файлы
  - Завершенные этапы
  - Финальная статистика

- **WARNING** - предупреждения (консоль + файл)
  - Проблемы с API
  - Файлы без ссылок для скачивания
  - Retry попытки

- **ERROR** - ошибки (консоль + файл)
  - Сетевые ошибки
  - Проблемы с файловой системой
  - Критические ошибки API

## Примеры вывода

### Консоль
```
12:07:52 | INFO     | Начало синхронизации с: https://disk.yandex.ru/d/...
12:07:52 | INFO     | Директория для скачивания: C:\Users\...\downloaded_files
12:07:53 | INFO     | Получение списка файлов...
12:07:55 | SUCCESS  | Создано папок: 42
12:08:00 | SUCCESS  | Скачан: docs/report.pdf (2.5 МБ)
12:08:01 | WARNING  | Ошибка при скачивании file.txt (попытка 1/3)
12:08:04 | SUCCESS  | Скачан: file.txt (1.2 КБ)
```

### Файл (logs/sync_ya_disk.log)
```
2025-01-13 12:07:52 | INFO     | Начало синхронизации с: https://disk.yandex.ru/d/...
2025-01-13 12:07:52 | DEBUG    | ConnectionError: Connection timeout
2025-01-13 12:07:54 | WARNING  | Ошибка соединения (попытка 1/3)
2025-01-13 12:07:56 | DEBUG    | Retry successful
2025-01-13 12:08:00 | SUCCESS  | Скачан: docs/report.pdf (2.5 МБ)
```

## Ротация логов

- Файлы автоматически ротируются при достижении 10 МБ
- Старые логи сжимаются в .zip архивы
- Логи хранятся 7 дней, затем автоматически удаляются
- Формат архивов: `logs/sync_ya_disk.log.2025-01-13_12-00-00.zip`
- Все логи находятся в папке `logs/`

## Настройка уровня логирования

Чтобы изменить уровень логирования в консоли на DEBUG:

```python
logger.remove()
logger.add(
    sys.stderr,
    level="DEBUG",  # Изменено с INFO на DEBUG
    colorize=True
)
```

Чтобы отключить файловое логирование:

```python
# Закомментируйте второй logger.add()
# logger.add("logs/sync_ya_disk.log", ...)
```

## Логи и производительность

Логирование оптимизировано для минимального влияния на производительность:
- Асинхронная запись в файл
- Буферизация сообщений
- Условное форматирование
- Цветной вывод только в терминале

Даже при DEBUG уровне на производительность влияние минимально (<1%).
